---
title: "ggplot2 Basic Scatter Plot Vignette"
author: "Brian Singh"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
    chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# ggplot2

## Introduction
ggplot2 is a system for declaratively creating graphics, based on The Grammar of Graphics. You provide the data, tell ggplot2 how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details.

## Installation and initializing libraries
You may install ggplot2 in the following ways:

#1. Install the entire tidyverse
install.packages("tidyverse")

#2. Install just ggplot2
install.packages("ggplot2")

#3. Install the development version from GitHub
devtools::install_github("tidyverse/ggplot2")

You will need to initialize the libraries in order to read in data, as well as to utilize the functions of ggplot2.
```{r}
library(readr)
library(curl)
library(ggplot2)
library(dplyr)
```

Let's load data we will use for testing ggplot2 We will load data obtained from **Kaggle** a dataset about **NFL Passing Statistics 2009-2018** (see https://www.kaggle.com/omzqwonxei/nfl-passing-statistics-20092018). Note, the statistics for each year are separated into multiple CSVs (all with the same number of, and named, columns). We will use rbind() to aggregate the different data frames into one.

```{r}
pass_2009 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2009.csv"))
pass_2010 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2010.csv"))
pass_2011 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2011.csv"))
pass_2012 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2012.csv"))
pass_2013 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2013.csv"))
pass_2014 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2014.csv"))
pass_2015 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2015.csv"))
pass_2016 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2016.csv"))
pass_2017 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2017.csv"))
pass_2018 <- read.csv(curl("https://raw.githubusercontent.com/brsingh7/Data606/main/pass-2018.csv"))
nfl_passing_2009_2018 <- rbind(pass_2009,pass_2010,pass_2011,pass_2012,pass_2013,pass_2014,pass_2015,pass_2016,pass_2017,pass_2018)
```

## Main functions
There are numerous functions you can use in ggplot2 to develop your visualizations. We will focus on some of the basic ones to get you started.

### ggplot()
**ggplot()** initializes a **ggplot** object. Within ggplot, you can specific the data to be used, as well as the aesthetics to apply. It can be used in conjunction with geom_point(), geom_bar(), etc., to create scatterplots, bar charts, as desired.

**USAGE**
ggplot(data = dataframe, mapping = aes(x,y,color,etc.))

**Use cases**
Use a scatterplot to plot a player's age (x-axis) and total passing yards from 2009-2018 (y-axis).

```{r}
nfl_passing_2009_2018 %>%
  ggplot(aes(x=Age, y=Yds)) +
  geom_point()
```

Add color based on total yards thrown. The default color assigned is blue.

```{r}
nfl_passing_2009_2018 %>%
  ggplot(aes(x=Age, y=Yds, color=Yds)) +
  geom_point()
```

You can change add filters, as well as change the size of the bubbles on the scatterplot. In the case below, we'll look for quarterbacks only, over the age of 30, who played a minimum of 13 games, and change the size of the plots to 3.

```{r}
nfl_passing_2009_2018 %>%
    filter(Pos=="QB",Age>30,G>13) %>%
  ggplot(aes(x=Age, y=Yds, color=Yds,size=3)) +
  geom_point()
```

We can take this one step further using the **scales** and customize the tick marks so that they don't take up that much space in the visualization, add title, and customize color palatte.

```{r customize-ticks}
library(scales)

nfl_passing_2009_2018 %>%
    filter(Pos=="QB",Age>30,G>13) %>%
    ggplot(aes(x=Age, y=Yds, color=Yds)) +
      geom_point() +
      scale_y_continuous(label = label_number(
        scale = .001,
        suffix = "k"
      )) +
      scale_color_viridis_c(label = label_number(
        scale = .001,
        suffix = "k"
      )) +
      labs(title = "2009-2018 QB +30")
  
```

### AES
**AES** it's an important part of the ggplot structure. In order to specify the axes, we need to use the aes() function. aes is short for “aesthetic”, and it is where we tell ggplot what columns we want to use for different parts of the plot.

```{r}
nfl_passing_2009_2018 %>%
    filter(Pos=="QB",Age>30,G>13) %>%
  ggplot(aes(x=Age, y=Yds, color=Yds,size=3)) +
  geom_point()
```

Here we telling R that Age will be our X axis, and Yds will be our Y axis. Also we include **color** which will be driven by the Yds paramater.

### Geoms
Typically when we think of visualizations, we normally think about the type of graph since it’s really the shapes that we see that tell us most of the information. While the ggplot2 package gives us a lot of flexibility in terms of choosing a shape to draw the data, it’s worth taking some time to consider which one is best for our question.

To create a line graph with ggplot(), we use the **geom_line()** function. A geom is the name for the specific shape that we want to use to visualize the data. All of the functions that are used to draw these shapes have geom in front of them. **geom_line()** creates a line graph, **geom_point()** creates a scatter plot, and so on.

```{r}
nfl_passing_2009_2018 %>%
    filter(Pos=="QB",Age>30,G>13) %>%
  ggplot(aes(x=Age, y=Yds, color=Yds,size=3)) +
  geom_point()
```

In this case **geom_point()** is telling R and qqplot to plot a single point for each piece of data, thus we would get a scatterplot.


### ggplot2 cheat sheet
More information on various ggplots to use, as well as additional aesthetics can be found here: https://github.com/rstudio/cheatsheets/blob/main/data-visualization-2.1.pdf .


***

### Extension

Number of interceptions vs number of times sacked colored by age. You can change the color scale by passing color names to the `low` and `high` parameters in `scale_colour_gradient`.
```{r}
ggplot(data=nfl_passing_2009_2018) +
  geom_point(aes(x=Int, y=Sk, color=Age))  + 
  scale_colour_gradient(low="black", high="red")
```


A scatterplot of the number of times sacked vs number of interceptions for the Houston Texans and the Carolina Panthers. Add the `shape` and `color` parameters to aes() to better discern between the two teams. You can also change the axis labels with xlab() and ylab().
```{r}
hou_df <- nfl_passing_2009_2018 %>% 
  filter(Tm=="HOU")

car_df <- nfl_passing_2009_2018 %>% 
  filter(Tm=="CAR")

hou_car_df <- rbind(hou_df, car_df)

ggplot(data=hou_car_df) +
  geom_point(aes(x=Int, y=Sk, shape=Tm, color=Tm), size=3) +
  labs(title="Houston Texans vs Carolina Panthers") +
  xlab("Number of Interceptions") + 
  ylab("Number of Times Sacked")
```

***
